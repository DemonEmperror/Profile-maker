<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Resume - Edit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .profile-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }
        .profile-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
        }
        .profile-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        .profile-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        .profile-content {
            padding: 2.5rem;
        }
        .section {
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            border-radius: 12px;
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
            position: relative;
        }
        .section:hover {
            background: #f1f5f9;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .section-title::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
        }
        .section-content {
            overflow: hidden;
        }
        .field {
            margin-bottom: 1.5rem;
            position: relative;
        }
        label {
            font-weight: 600;
            color: #374151;
            display: block;
            margin-bottom: 0.5rem;
        }
        .editable {
            width: 100%;
            padding: 12px;
            min-height: 40px;
            font-size: 15px;
            outline: none;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .editable:focus {
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }
        .field-group {
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid #10b981;
            position: relative;
        }
        .format-button, .add-button, .remove-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.5rem;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
        }
        .format-button:hover, .add-button:hover {
            background: #1e40af;
            transform: scale(1.05);
        }
        .remove-button {
            background: #ef4444;
        }
        .remove-button:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        .control-panel {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 1.5rem;
            margin: -2.5rem -2.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .control-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        .action-buttons {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            margin: 2rem -2.5rem -2.5rem;
            padding: 2rem 2.5rem;
            text-align: center;
            border-radius: 0 0 20px 20px;
        }
        .action-buttons button {
            background: white;
            color: #059669;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        .action-buttons button:hover {
            background: #f0fdf4;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .modal, .format-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content, .format-modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .format-modal-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .format-toolbar {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #f3f2f1;
            border-radius: 4px;
        }
        .format-toolbar button {
            background: none;
            border: none;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
        }
        .format-toolbar button:hover {
            background: #e1dfdd;
        }
        .format-editor {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            font-size: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            outline: none;
        }
        .format-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        .format-actions button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .format-actions .save {
            background: #10b981;
            color: white;
        }
        .format-actions .cancel {
            background: #ef4444;
            color: white;
        }
        .suggestion {
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 0;
        }
        .suggestion:last-child {
            border-bottom: none;
        }
        .suggestion p {
            margin: 0.5rem 0;
        }
        .suggestion button {
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .suggestion .accept {
            background: #10b981;
            color: white;
        }
        .suggestion .reject {
            background: #ef4444;
            color: white;
        }
        @media (max-width: 768px) {
            .profile-container {
                margin: 1rem;
            }
            .profile-name {
                font-size: 2rem;
            }
            .profile-content {
                padding: 1.5rem;
            }
            .section {
                padding: 1rem;
            }
            .action-buttons button {
                width: 100%;
                margin: 0.5rem 0;
            }
            .control-panel {
                flex-direction: column;
                text-align: center;
            }
        }
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .profile-container {
                box-shadow: none;
                border-radius: 0;
            }
            .profile-header {
                background: #1e40af !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .action-buttons, .modal, .format-modal, .format-button, .add-button, .remove-button, .control-panel {
                display: none;
            }
            .editable {
                border: none;
                background: transparent;
                padding: 0;
                width: auto;
                display: inline-block;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="profile-container">
        <div class="profile-header">
            <h1 class="profile-name">Edit Professional Resume</h1>
        </div>
        <div class="profile-content">
            <div class="control-panel">
                <div>
                    <h3 class="text-lg font-medium">Resume Editor</h3>
                    <p class="text-sm opacity-90 mt-1">Customize and format your professional resume</p>
                </div>
                <div class="flex gap-4 flex-wrap">
                    <button class="control-btn" onclick="checkGrammar()">Check Grammar</button>
                    <button class="control-btn" onclick="clearAllFields()">Clear All</button>
                </div>
            </div>
            <form id="profile-form" method="POST" action="/update_profile">
                <input type="hidden" name="profile_data" value='{{ profile | tojson | safe }}'>
                <div class="section">
                    <h2 class="section-title">Name</h2>
                    <div id="name-section" class="section-content">
                        <div class="field">
                            <label for="name">Name:</label>
                            <div class="editable" id="name" contenteditable="true" spellcheck="true">{{ profile.get('name', '') | safe }}</div>
                            <button type="button" class="format-button" onclick="openFormatModal('name')">Format</button>
                            <input type="hidden" id="name_hidden" name="name">
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Subtitle</h2>
                    <div id="subtitle-section" class="section-content">
                        <div class="field">
                            <label for="subtitle">Subtitle:</label>
                            <div class="editable" id="subtitle" contenteditable="true" spellcheck="true">{{ profile.get('subtitle', profile.get('professional_summary', '')[:1500] if profile.get('professional_summary') else 'Professional Software Developer') | safe }}</div>
                            <button type="button" class="format-button" onclick="openFormatModal('subtitle')">Format</button>
                            <input type="hidden" id="subtitle_hidden" name="subtitle">
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Education, Training, and Certifications</h2>
                    <div id="education-section" class="section-content">
                        <div id="education_training_certifications">
                            {% for item in profile.get('education_training_certifications', []) %}
                                <div class="field field-group" id="etc_field_{{ loop.index0 }}">
                                    <div class="editable" id="etc_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ item | safe }}</div>
                                    <button type="button" class="format-button" onclick="openFormatModal('etc_{{ loop.index0 }}')">Format</button>
                                    <button type="button" class="remove-button" onclick="removeField('etc_field_{{ loop.index0 }}', 'etc_{{ loop.index0 }}')">Remove</button>
                                    <input type="hidden" name="education_training_certifications[]" id="etc_{{ loop.index0 }}_hidden">
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" class="add-button" onclick="addEducationField()">Add Education</button>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Total Experience</h2>
                    <div id="experience-section" class="section-content">
                        <div class="field">
                            <label for="total_experience">Total Experience:</label>
                            <div class="editable" id="total_experience" contenteditable="true" spellcheck="true">{{ profile.get('total_experience', '') | safe }}</div>
                            <button type="button" class="format-button" onclick="openFormatModal('total_experience')">Format</button>
                            <input type="hidden" id="total_experience_hidden" name="total_experience">
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Professional Summary</h2>
                    <div id="summary-section" class="section-content">
                        <div class="field">
                            <label for="professional_summary">Summary:</label>
                            <div class="editable" id="professional_summary" contenteditable="true" spellcheck="true">{{ profile.get('professional_summary', '') | safe }}</div>
                            <button type="button" class="format-button" onclick="openFormatModal('professional_summary')">Format</button>
                            <input type="hidden" id="professional_summary_hidden" name="professional_summary">
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">NetWeb Projects</h2>
                    <div id="netweb-projects-section" class="section-content">
                        <div id="netweb_projects">
                            {% for project in profile.get('netweb_projects', []) %}
                                <div class="field field-group" id="netweb_project_{{ loop.index0 }}">
                                    <label>Title:</label>
                                    <div class="editable" id="netweb_title_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ project.get('title', '') | safe }}</div>
                                    <button type="button" class="format-button" onclick="openFormatModal('netweb_title_{{ loop.index0 }}')">Format</button>
                                    <input type="hidden" name="netweb_projects[title][]" id="netweb_title_{{ loop.index0 }}_hidden">
                                    <label>Description:</label>
                                    <div class="editable" id="netweb_desc_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ project.get('description', '') | safe }}</div>
                                    <button type="button" class="format-button" onclick="openFormatModal('netweb_desc_{{ loop.index0 }}')">Format</button>
                                    <input type="hidden" name="netweb_projects[description][]" id="netweb_desc_{{ loop.index0 }}_hidden">
                                    <button type="button" class="remove-button" onclick="removeField('netweb_project_{{ loop.index0 }}')">Remove</button>
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" class="add-button" onclick="addProjectField('netweb')">Add Project</button>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Past Projects</h2>
                    <div id="past-projects-section" class="section-content">
                        <div id="past_projects">
                            {% for project in profile.get('past_projects', []) %}
                                <div class="field field-group" id="past_project_{{ loop.index0 }}">
                                    <label>Title:</label>
                                    <div class="editable" id="past_title_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ project.get('title', '') | safe }}</div>
                                    <button type="button" class="format-button" onclick="openFormatModal('past_title_{{ loop.index0 }}')">Format</button>
                                    <input type="hidden" name="past_projects[title][]" id="past_title_{{ loop.index0 }}_hidden">
                                    <label>Description:</label>
                                    <div class="editable" id="past_desc_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ project.get('description', '') | safe }}</div>
                                    <button type="button" class="format-button" onclick="openFormatModal('past_desc_{{ loop.index0 }}')">Format</button>
                                    <input type="hidden" name="past_projects[description][]" id="past_desc_{{ loop.index0 }}_hidden">
                                    <button type="button" class="remove-button" onclick="removeField('past_project_{{ loop.index0 }}')">Remove</button>
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" class="add-button" onclick="addProjectField('past')">Add Project</button>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Roles and Responsibilities</h2>
                    <div id="roles-section" class="section-content">
                        <div class="field">
                            <label for="roles_responsibilities">Roles:</label>
                            <div class="editable" id="roles_responsibilities" contenteditable="true" spellcheck="true">{{ profile.get('roles_responsibilities', '') | safe }}</div>
                            <button type="button" class="format-button" onclick="openFormatModal('roles_responsibilities')">Format</button>
                            <input type="hidden" id="roles_responsibilities_hidden" name="roles_responsibilities">
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Technical Skills</h2>
                    <div id="skills-section" class="section-content">
                        <div class="field">
                            <label>Web Technologies:</label>
                            <div id="technical_skills_web_technologies">
                                {% for skill in profile.get('technical_skills', {}).get('web_technologies', []) %}
                                    <div class="field field-group" id="web_tech_field_{{ loop.index0 }}">
                                        <div class="editable" id="web_tech_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ skill | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('web_tech_{{ loop.index0 }}')">Format</button>
                                        <button type="button" class="remove-button" onclick="removeField('web_tech_field_{{ loop.index0 }}', 'web_tech_{{ loop.index0 }}')">Remove</button>
                                        <input type="hidden" name="technical_skills[web_technologies][]" id="web_tech_{{ loop.index0 }}_hidden">
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="add-button" onclick="addSkillField('web_technologies')">Add Web Technology</button>
                        </div>
                        <div class="field">
                            <label>Scripting Languages:</label>
                            <div id="technical_skills_scripting_languages">
                                {% for skill in profile.get('technical_skills', {}).get('scripting_languages', []) %}
                                    <div class="field field-group" id="script_lang_field_{{ loop.index0 }}">
                                        <div class="editable" id="script_lang_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ skill | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('script_lang_{{ loop.index0 }}')">Format</button>
                                        <button type="button" class="remove-button" onclick="removeField('script_lang_field_{{ loop.index0 }}', 'script_lang_{{ loop.index0 }}')">Remove</button>
                                        <input type="hidden" name="technical_skills[scripting_languages][]" id="script_lang_{{ loop.index0 }}_hidden">
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="add-button" onclick="addSkillField('scripting_languages')">Add Scripting Language</button>
                        </div>
                        <div class="field">
                            <label>Frameworks:</label>
                            <div id="technical_skills_frameworks">
                                {% for skill in profile.get('technical_skills', {}).get('frameworks', []) %}
                                    <div class="field field-group" id="framework_field_{{ loop.index0 }}">
                                        <div class="editable" id="framework_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ skill | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('framework_{{ loop.index0 }}')">Format</button>
                                        <button type="button" class="remove-button" onclick="removeField('framework_field_{{ loop.index0 }}', 'framework_{{ loop.index0 }}')">Remove</button>
                                        <input type="hidden" name="technical_skills[frameworks][]" id="framework_{{ loop.index0 }}_hidden">
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="add-button" onclick="addSkillField('frameworks')">Add Framework</button>
                        </div>
                        <div class="field">
                            <label>Databases:</label>
                            <div id="technical_skills_databases">
                                {% for skill in profile.get('technical_skills', {}).get('databases', []) %}
                                    <div class="field field-group" id="database_field_{{ loop.index0 }}">
                                        <div class="editable" id="database_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ skill | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('database_{{ loop.index0 }}')">Format</button>
                                        <button type="button" class="remove-button" onclick="removeField('database_field_{{ loop.index0 }}', 'database_{{ loop.index0 }}')">Remove</button>
                                        <input type="hidden" name="technical_skills[databases][]" id="database_{{ loop.index0 }}_hidden">
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="add-button" onclick="addSkillField('databases')">Add Database</button>
                        </div>
                        <div class="field">
                            <label>Web Servers:</label>
                            <div id="technical_skills_web_servers">
                                {% for skill in profile.get('technical_skills', {}).get('web_servers', []) %}
                                    <div class="field field-group" id="web_server_field_{{ loop.index0 }}">
                                        <div class="editable" id="web_server_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ skill | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('web_server_{{ loop.index0 }}')">Format</button>
                                        <button type="button" class="remove-button" onclick="removeField('web_server_field_{{ loop.index0 }}', 'web_server_{{ loop.index0 }}')">Remove</button>
                                        <input type="hidden" name="technical_skills[web_servers][]" id="web_server_{{ loop.index0 }}_hidden">
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="add-button" onclick="addSkillField('web_servers')">Add Web Server</button>
                        </div>
                        <div class="field">
                            <label>Tools:</label>
                            <div id="technical_skills_tools">
                                {% for skill in profile.get('technical_skills', {}).get('tools', []) %}
                                    <div class="field field-group" id="tool_field_{{ loop.index0 }}">
                                        <div class="editable" id="tool_{{ loop.index0 }}" contenteditable="true" spellcheck="true">{{ skill | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('tool_{{ loop.index0 }}')">Format</button>
                                        <button type="button" class="remove-button" onclick="removeField('tool_field_{{ loop.index0 }}', 'tool_{{ loop.index0 }}')">Remove</button>
                                        <input type="hidden" name="technical_skills[tools][]" id="tool_{{ loop.index0 }}_hidden">
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="add-button" onclick="addSkillField('tools')">Add Tool</button>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Personal Details</h2>
                    <div id="personal-details-section" class="section-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {% for field in ['employee_id', 'designation', 'date_of_joining', 'overall_experience', 'date_of_birth', 'contact_number', 'permanent_address', 'local_address', 'passport_details'] %}
                                {% if profile.get('personal_details', {}).get(field) or not profile.get('personal_details') %}
                                    <div class="field field-group">
                                        <label for="{{ field }}">{{ field.replace('_', ' ').title() }}:</label>
                                        <div class="editable" id="{{ field }}" contenteditable="true" spellcheck="true">{{ profile.get('personal_details', {}).get(field, '') | safe }}</div>
                                        <button type="button" class="format-button" onclick="openFormatModal('{{ field }}')">Format</button>
                                        <input type="hidden" id="{{ field }}_hidden" name="personal_details[{{ field }}]">
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="submit" name="action" value="save">Save Profile Changes</button>
                    <button type="button" onclick="previewResume()">Preview Resume</button>
                </div>
            </form>
        </div>
    </div>
    <div id="grammarModal" class="modal">
        <div class="modal-content">
            <h3 class="text-lg font-semibold">Grammar Suggestions</h3>
            <div id="suggestions" class="mt-4"></div>
            <button class="mt-4 bg-red-500 text-white px-4 py-2 rounded" onclick="closeModal()">Close</button>
        </div>
    </div>
    <div id="formatModal" class="format-modal">
        <div class="format-modal-content">
            <h3 class="text-lg font-semibold">Format Text</h3>
            <div class="format-toolbar">
                <button type="button" onclick="formatModalText('bold')"><b>B</b></button>
                <button type="button" onclick="formatModalText('italic')"><i>I</i></button>
                <button type="button" onclick="formatModalText('underline')"><u>U</u></button>
                <button type="button" onclick="formatModalText('insertUnorderedList')">â€¢ List</button>
                <button type="button" onclick="formatModalText('insertOrderedList')">1. List</button>
            </div>
            <div class="format-editor" id="formatEditor" contenteditable="true"></div>
            <div class="format-actions">
                <button class="save" onclick="saveFormatChanges()">Save</button>
                <button class="cancel" onclick="closeFormatModal()">Cancel</button>
            </div>
        </div>
    </div>
    <script>
        let currentFieldId = '';
        let educationIndex = document.querySelectorAll('#education_training_certifications .field-group').length;
        let netwebProjectIndex = document.querySelectorAll('#netweb_projects .field-group').length;
        let pastProjectIndex = document.querySelectorAll('#past_projects .field-group').length;
        let workExperienceIndex = document.querySelectorAll('#work_experience .field-group').length;
        let skillIndices = {
            web_technologies: document.querySelectorAll('#technical_skills_web_technologies .field').length,
            scripting_languages: document.querySelectorAll('#technical_skills_scripting_languages .field').length,
            frameworks: document.querySelectorAll('#technical_skills_frameworks .field').length,
            databases: document.querySelectorAll('#technical_skills_databases .field').length,
            web_servers: document.querySelectorAll('#technical_skills_web_servers .field').length,
            tools: document.querySelectorAll('#technical_skills_tools .field').length
        };

        window.addEventListener('load', () => {
            console.log('Window loaded, initializing fields');
            updateAllHiddenFields();
            setupEditableFields();
            setupSectionHover();
        });

        function setupSectionHover() {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(10px)';
                    this.style.boxShadow = '0 8px 25px rgba(59, 130, 246, 0.2)';
                });
                section.addEventListener('mouseleave', function() {
                    this.style.transform = '';
                    this.style.boxShadow = '';
                });
            });
        }

        document.getElementById('profile-form').addEventListener('submit', function(event) {
            console.log('Form submission started');
            updateProjectDescriptions('netweb');
            updateProjectDescriptions('past');
            updateWorkExperience();
            updateAllHiddenFields();
            const formData = new FormData(this);
            console.log('Form data being sent:');
            for (let [key, value] of formData.entries()) {
                console.log(`Form data: ${key}=${value}`);
            }
        });

        function previewResume() {
            updateAllHiddenFields();
            updateWorkExperience();
            const form = document.getElementById('profile-form');
            const formData = new FormData(form);
            const profileData = {};
            for (let [key, value] of formData.entries()) {
                if (key.includes('[]') || key.includes('[title]') || key.includes('[description]') || key.includes('[role]') || key.includes('[start_date]') || key.includes('[end_date]') || key.includes('[responsibilities]') || key.includes('personal_details')) {
                    if (!profileData[key]) profileData[key] = [];
                    profileData[key].push(value);
                } else {
                    profileData[key] = value;
                }
            }
            const formElement = document.createElement('form');
            formElement.method = 'POST';
            formElement.action = '/preview';
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'profile_data';
            input.value = encodeURIComponent(JSON.stringify(profileData));
            formElement.appendChild(input);
            document.body.appendChild(formElement);
            formElement.submit();
        }

        function clearAllFields() {
            const editables = document.querySelectorAll('.editable');
            editables.forEach(editable => {
                editable.innerHTML = '';
                updateHiddenField(editable.id);
            });
            updateProjectDescriptions('netweb');
            updateProjectDescriptions('past');
            updateWorkExperience();
            console.log('All fields cleared');
        }

        function openFormatModal(fieldId) {
            currentFieldId = fieldId;
            const field = document.getElementById(fieldId);
            const editor = document.getElementById('formatEditor');
            if (field) {
                editor.innerHTML = field.innerHTML;
                document.getElementById('formatModal').style.display = 'flex';
                editor.focus();
            } else {
                console.error(`Field ${fieldId} not found`);
            }
        }

        function closeFormatModal() {
            document.getElementById('formatModal').style.display = 'none';
            currentFieldId = '';
            document.getElementById('formatEditor').innerHTML = '';
        }

        function formatModalText(command) {
            const editor = document.getElementById('formatEditor');
            document.getSelection().selectAllChildren(editor);
            document.execCommand(command, false, null);
            editor.focus();
            if (currentFieldId) {
                const field = document.getElementById(currentFieldId);
                field.innerHTML = editor.innerHTML;
                field.dispatchEvent(new Event('input'));
                updateHiddenField(currentFieldId);
                if (currentFieldId.includes('_desc_') || currentFieldId.includes('_title_')) {
                    updateProjectDescriptions(currentFieldId.split('_')[0]);
                } else if (currentFieldId.includes('_role_') || currentFieldId.includes('_start_date_') || currentFieldId.includes('_end_date_') || currentFieldId.includes('_resp_')) {
                    updateWorkExperience();
                }
            }
        }

        function saveFormatChanges() {
            if (currentFieldId) {
                const editor = document.getElementById('formatEditor');
                const field = document.getElementById(currentFieldId);
                if (field) {
                    field.innerHTML = editor.innerHTML;
                    field.dispatchEvent(new Event('input'));
                    updateHiddenField(currentFieldId);
                    if (currentFieldId.includes('_desc_') || currentFieldId.includes('_title_')) {
                        updateProjectDescriptions(currentFieldId.split('_')[0]);
                    } else if (currentFieldId.includes('_role_') || currentFieldId.includes('_start_date_') || currentFieldId.includes('_end_date_') || currentFieldId.includes('_resp_')) {
                        updateWorkExperience();
                    }
                    closeFormatModal();
                } else {
                    console.error(`Field ${currentFieldId} not found during save`);
                }
            }
        }

        function updateProjectDescriptions(type) {
            const containers = document.querySelectorAll(`#${type}_projects .field-group`);
            containers.forEach((container, projectIndex) => {
                const titleEditable = document.getElementById(`${type}_title_${projectIndex}`);
                const titleHidden = document.getElementById(`${type}_title_${projectIndex}_hidden`);
                if (titleEditable && titleHidden) {
                    titleHidden.value = titleEditable.innerHTML.trim();
                    console.log(`Updated ${type}_title_${projectIndex}_hidden:`, titleHidden.value);
                } else {
                    console.warn(`Missing title field for ${type}_project_${projectIndex}:`, { titleEditable, titleHidden });
                }
                const descEditable = document.getElementById(`${type}_desc_${projectIndex}`);
                const descHidden = document.getElementById(`${type}_desc_${projectIndex}_hidden`);
                if (descEditable && descHidden) {
                    descHidden.value = descEditable.innerHTML.trim();
                    console.log(`Updated ${type}_desc_${projectIndex}_hidden:`, descHidden.value);
                } else {
                    console.warn(`Missing description field for ${type}_project_${projectIndex}:`, { descEditable, descHidden });
                }
            });
        }

        function updateWorkExperience() {
            const containers = document.querySelectorAll('#work_experience .field-group');
            containers.forEach((container, index) => {
                const roleEditable = document.getElementById(`work_role_${index}`);
                const roleHidden = document.getElementById(`work_role_${index}_hidden`);
                if (roleEditable && roleHidden) {
                    roleHidden.value = roleEditable.innerHTML.trim();
                    console.log(`Updated work_role_${index}_hidden:`, roleHidden.value);
                } else {
                    console.warn(`Missing role field for work_exp_${index}:`, { roleEditable, roleHidden });
                }
                const startDateEditable = document.getElementById(`work_start_date_${index}`);
                const startDateHidden = document.getElementById(`work_start_date_${index}_hidden`);
                if (startDateEditable && startDateHidden) {
                    startDateHidden.value = startDateEditable.innerHTML.trim();
                    console.log(`Updated work_start_date_${index}_hidden:`, startDateHidden.value);
                } else {
                    console.warn(`Missing start date field for work_exp_${index}:`, { startDateEditable, startDateHidden });
                }
                const endDateEditable = document.getElementById(`work_end_date_${index}`);
                const endDateHidden = document.getElementById(`work_end_date_${index}_hidden`);
                if (endDateEditable && endDateHidden) {
                    endDateHidden.value = endDateEditable.innerHTML.trim();
                    console.log(`Updated work_end_date_${index}_hidden:`, endDateHidden.value);
                } else {
                    console.warn(`Missing end date field for work_exp_${index}:`, { endDateEditable, endDateHidden });
                }
                const respEditable = document.getElementById(`work_resp_${index}`);
                const respHidden = document.getElementById(`work_resp_${index}_hidden`);
                if (respEditable && respHidden) {
                    respHidden.value = respEditable.innerHTML.trim();
                    console.log(`Updated work_resp_${index}_hidden:`, respHidden.value);
                } else {
                    console.warn(`Missing responsibilities field for work_exp_${index}:`, { respEditable, respHidden });
                }
            });
        }

        function updateHiddenField(elementId) {
            const editable = document.getElementById(elementId);
            const hiddenInput = document.getElementById(`${elementId}_hidden`);
            if (editable && hiddenInput) {
                hiddenInput.value = editable.innerHTML.trim();
                console.log(`Updated ${elementId}_hidden:`, hiddenInput.value);
            } else {
                console.error(`Failed to update hidden field for ${elementId}:`, { editable, hiddenInput });
            }
        }

        function updateAllHiddenFields() {
            console.log('Updating all hidden fields');
            const fields = [
                'name', 'subtitle', 'total_experience', 'professional_summary', 'roles_responsibilities',
                'employee_id', 'permanent_address', 'local_address', 'contact_number',
                'date_of_joining', 'designation', 'overall_experience', 'date_of_birth',
                'passport_details'
            ];
            fields.forEach(field => {
                try {
                    updateHiddenField(field);
                } catch (e) {
                    console.error(`Error updating hidden field ${field}:`, e);
                }
            });
            document.querySelectorAll('[id^=etc_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=web_tech_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=script_lang_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=framework_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=database_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=web_server_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=tool_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=work_role_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=work_start_date_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=work_end_date_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            document.querySelectorAll('[id^=work_resp_][id$=_hidden]').forEach(hidden => {
                const id = hidden.id.replace('_hidden', '');
                try {
                    updateHiddenField(id);
                } catch (e) {
                    console.error(`Error updating hidden field ${id}:`, e);
                }
            });
            ['netweb', 'past'].forEach(type => {
                updateProjectDescriptions(type);
            });
            updateWorkExperience();
        }

        function setupEditableFields() {
            console.log('Setting up editable fields');
            const fields = [
                'name', 'subtitle', 'total_experience', 'professional_summary', 'roles_responsibilities',
                'employee_id', 'permanent_address', 'local_address', 'contact_number',
                'date_of_joining', 'designation', 'overall_experience', 'date_of_birth',
                'passport_details'
            ];
            fields.forEach(field => {
                const editable = document.getElementById(field);
                if (editable) {
                    editable.addEventListener('input', () => updateHiddenField(field));
                } else {
                    console.warn(`Editable field ${field} not found`);
                }
            });
            document.querySelectorAll('[id^=etc_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=web_tech_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=script_lang_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=framework_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=database_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=web_server_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=tool_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => updateHiddenField(editable.id));
                }
            });
            document.querySelectorAll('[id^=work_role_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => {
                        console.log(`Input on ${editable.id}`);
                        updateWorkExperience();
                    });
                }
            });
            document.querySelectorAll('[id^=work_start_date_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => {
                        console.log(`Input on ${editable.id}`);
                        updateWorkExperience();
                    });
                }
            });
            document.querySelectorAll('[id^=work_end_date_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => {
                        console.log(`Input on ${editable.id}`);
                        updateWorkExperience();
                    });
                }
            });
            document.querySelectorAll('[id^=work_resp_]').forEach(editable => {
                if (!editable.id.endsWith('_hidden')) {
                    editable.addEventListener('input', () => {
                        console.log(`Input on ${editable.id}`);
                        updateWorkExperience();
                    });
                }
            });
            ['netweb', 'past'].forEach(type => {
                document.querySelectorAll(`[id^=${type}_title_]`).forEach(editable => {
                    if (!editable.id.endsWith('_hidden')) {
                        editable.addEventListener('input', () => {
                            console.log(`Input detected on ${editable.id}`);
                            updateProjectDescriptions(type);
                        });
                    }
                });
                document.querySelectorAll(`[id^=${type}_desc_]`).forEach(editable => {
                    if (!editable.id.endsWith('_hidden')) {
                        editable.addEventListener('input', () => {
                            console.log(`Input detected on ${editable.id}`);
                            updateProjectDescriptions(type);
                        });
                    }
                });
            });
        }

        function addEducationField() {
            const container = document.getElementById('education_training_certifications');
            const newField = document.createElement('div');
            newField.className = 'field field-group';
            newField.id = `etc_field_${educationIndex}`;
            newField.innerHTML = `
                <div class="editable" id="etc_${educationIndex}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('etc_${educationIndex}')">Format</button>
                <button type="button" class="remove-button" onclick="removeField('etc_field_${educationIndex}', 'etc_${educationIndex}')">Remove</button>
                <input type="hidden" name="education_training_certifications[]" id="etc_${educationIndex}_hidden">
            `;
            container.appendChild(newField);
            document.getElementById(`etc_${educationIndex}`).addEventListener('input', () => updateHiddenField(`etc_${educationIndex}`));
            educationIndex++;
            console.log(`Added education field etc_field_${educationIndex - 1}`);
        }

        function addProjectField(type) {
            const container = document.getElementById(`${type}_projects`);
            const index = type === 'netweb' ? netwebProjectIndex++ : pastProjectIndex++;
            const newField = document.createElement('div');
            newField.className = 'field field-group';
            newField.id = `${type}_project_${index}`;
            newField.innerHTML = `
                <label>Title:</label>
                <div class="editable" id="${type}_title_${index}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('${type}_title_${index}')">Format</button>
                <input type="hidden" name="${type}_projects[title][]" id="${type}_title_${index}_hidden">
                <label>Description:</label>
                <div class="editable" id="${type}_desc_${index}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('${type}_desc_${index}')">Format</button>
                <input type="hidden" name="${type}_projects[description][]" id="${type}_desc_${index}_hidden">
                <button type="button" class="remove-button" onclick="removeField('${type}_project_${index}')">Remove</button>
            `;
            container.appendChild(newField);
            [`${type}_title_${index}`, `${type}_desc_${index}`].forEach(id => {
                const editable = document.getElementById(id);
                if (editable) {
                    editable.addEventListener('input', () => {
                        console.log(`Input on ${id}`);
                        updateProjectDescriptions(type);
                    });
                } else {
                    console.error(`Editable field ${id} not found after adding`);
                }
            });
            console.log(`Added ${type} project field ${type}_project_${index}`);
        }

        function addWorkExperienceField() {
            const container = document.getElementById('work_experience');
            const newField = document.createElement('div');
            newField.className = 'field field-group';
            newField.id = `work_exp_${workExperienceIndex}`;
            newField.innerHTML = `
                <label>Role:</label>
                <div class="editable" id="work_role_${workExperienceIndex}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('work_role_${workExperienceIndex}')">Format</button>
                <input type="hidden" name="work_experience[role][]" id="work_role_${workExperienceIndex}_hidden">
                <label>Start Date:</label>
                <div class="editable" id="work_start_date_${workExperienceIndex}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('work_start_date_${workExperienceIndex}')">Format</button>
                <input type="hidden" name="work_experience[start_date][]" id="work_start_date_${workExperienceIndex}_hidden">
                <label>End Date:</label>
                <div class="editable" id="work_end_date_${workExperienceIndex}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('work_end_date_${workExperienceIndex}')">Format</button>
                <input type="hidden" name="work_experience[end_date][]" id="work_end_date_${workExperienceIndex}_hidden">
                <label>Responsibilities:</label>
                <div class="editable" id="work_resp_${workExperienceIndex}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('work_resp_${workExperienceIndex}')">Format</button>
                <input type="hidden" name="work_experience[responsibilities][]" id="work_resp_${workExperienceIndex}_hidden">
                <button type="button" class="remove-button" onclick="removeField('work_exp_${workExperienceIndex}')">Remove</button>
            `;
            container.appendChild(newField);
            ['work_role_', 'work_start_date_', 'work_end_date_', 'work_resp_'].forEach(prefix => {
                const id = `${prefix}${workExperienceIndex}`;
                const editable = document.getElementById(id);
                if (editable) {
                    editable.addEventListener('input', () => {
                        console.log(`Input on ${id}`);
                        updateWorkExperience();
                    });
                } else {
                    console.error(`Editable field ${id} not found after adding`);
                }
            });
            console.log(`Added work experience field work_exp_${workExperienceIndex}`);
            workExperienceIndex++;
        }

        function addSkillField(category) {
            const container = document.getElementById(`technical_skills_${category}`);
            const index = skillIndices[category]++;
            const newField = document.createElement('div');
            newField.className = 'field field-group';
            newField.id = `${category}_field_${index}`;
            newField.innerHTML = `
                <div class="editable" id="${category}_${index}" contenteditable="true" spellcheck="true"></div>
                <button type="button" class="format-button" onclick="openFormatModal('${category}_${index}')">Format</button>
                <button type="button" class="remove-button" onclick="removeField('${category}_field_${index}', '${category}_${index}')">Remove</button>
                <input type="hidden" name="technical_skills[${category}][]" id="${category}_${index}_hidden">
            `;
            container.appendChild(newField);
            const editable = document.getElementById(`${category}_${index}`);
            if (editable) {
                editable.addEventListener('input', () => updateHiddenField(`${category}_${index}`));
            }
            console.log(`Added skill field ${category}_${index}`);
        }

        function removeField(fieldId, editableId = null) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.remove();
                if (editableId) {
                    updateHiddenField(editableId);
                }
                if (fieldId.includes('netweb_project') || fieldId.includes('past_project')) {
                    updateProjectDescriptions(fieldId.split('_')[0]);
                } else if (fieldId.includes('work_exp')) {
                    updateWorkExperience();
                }
                console.log(`Removed field ${fieldId}`);
            } else {
                console.error(`Field ${fieldId} not found for removal`);
            }
        }

        function checkGrammar() {
            const form = document.getElementById('profile-form');
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (key.includes('[]') || key.includes('[title]') || key.includes('[description]') || key.includes('[role]') || key.includes('[start_date]') || key.includes('[end_date]') || key.includes('[responsibilities]') || key.includes('personal_details')) {
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }
            fetch('/check_grammar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(suggestions => {
                displaySuggestions(suggestions);
            })
            .catch(error => {
                console.error('Error checking grammar:', error);
                alert('Failed to check grammar. Please try again.');
            });
        }

        function displaySuggestions(suggestions) {
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            if (suggestions.length === 0) {
                suggestionsDiv.innerHTML = '<p>No grammar issues found.</p>';
            } else {
                suggestions.forEach((suggestion, index) => {
                    const suggestionDiv = document.createElement('div');
                    suggestionDiv.className = 'suggestion';
                    suggestionDiv.innerHTML = `
                        <p><strong>Field:</strong> ${suggestion.field}</p>
                        <p><strong>Original:</strong> ${suggestion.original}</p>
                        <p><strong>Suggested:</strong> ${suggestion.suggested}</p>
                        <p><strong>Reason:</strong> ${suggestion.reason}</p>
                        <button class="accept" onclick="applySuggestion('${suggestion.field_id}', '${suggestion.suggested.replace(/'/g, "\\'")}')">Accept</button>
                        <button class="reject" onclick="this.parentElement.remove()">Reject</button>
                    `;
                    suggestionsDiv.appendChild(suggestionDiv);
                });
            }
            document.getElementById('grammarModal').style.display = 'flex';
        }

        function applySuggestion(fieldId, suggestedText) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.innerHTML = suggestedText;
                field.dispatchEvent(new Event('input'));
                updateHiddenField(fieldId);
                if (fieldId.includes('_desc_') || fieldId.includes('_title_')) {
                    updateProjectDescriptions(fieldId.split('_')[0]);
                } else if (fieldId.includes('_role_') || fieldId.includes('_start_date_') || fieldId.includes('_end_date_') || fieldId.includes('_resp_')) {
                    updateWorkExperience();
                }
                const suggestionDiv = document.querySelector(`.suggestion button[onclick*="applySuggestion('${fieldId}'"]`).parentElement;
                suggestionDiv.remove();
                if (!document.querySelector('.suggestion')) {
                    document.getElementById('grammarModal').style.display = 'none';
                }
            } else {
                console.error(`Field ${fieldId} not found for suggestion`);
            }
        }

        function closeModal() {
            document.getElementById('grammarModal').style.display = 'none';
        }
    </script>
</body>
</html>